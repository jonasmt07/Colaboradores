{% macro render_employee_card(employee) %}

{% set fallback_avatar = "https://ui-avatars.com/api/?name=" + (employee.nome | urlencode) + "&background=F1F5F9&color=475569&size=128&bold=true" %}
{% set image_src = fallback_avatar %}

{% if employee.foto_url %}
    {% if 'http' in employee.foto_url %}
        {% set image_src = employee.foto_url %}
    {% else %}
        {% set image_src = url_for('static', filename='img/fotos/' + employee.foto_url) %}
    {% endif %}
{% endif %}

<div class="group bg-white rounded-2xl border border-slate-200 hover:border-indigo-400 shadow-sm hover:shadow-lg transition-all duration-300 p-6 flex flex-col md:flex-row items-start md:items-center gap-6 relative overflow-hidden">
    
    <div class="absolute top-0 left-0 w-1.5 h-full bg-gradient-to-b from-indigo-500 to-purple-600 transform -translate-x-full group-hover:translate-x-0 transition-transform duration-300"></div>

    <div class="flex-shrink-0">
        <div class="w-20 h-20 md:w-24 md:h-24 rounded-full p-1 bg-white border-2 border-slate-100 group-hover:border-indigo-200 transition-colors shadow-sm">
            <img src="{{ image_src }}" 
                 alt="{{ employee.nome }}"
                 onerror="this.onerror=null; this.src='{{ fallback_avatar }}';"
                 class="w-full h-full object-cover rounded-full" />
        </div>
    </div>

    <div class="flex-1 min-w-0 flex flex-col justify-center gap-1">
        
        <h3 class="text-xl md:text-2xl font-bold text-slate-800 break-words group-hover:text-indigo-700 transition-colors leading-tight">
            {{ employee.nome }}
        </h3>
        
        <p class="text-base text-indigo-600 font-semibold flex items-center gap-2">
            {{ employee.cargo or 'Cargo não informado' }}
        </p>

        <div class="flex items-start gap-2 text-slate-500 mt-1">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 flex-shrink-0 mt-0.5 text-slate-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="4" y="2" width="16" height="20" rx="2" ry="2"></rect><line x1="9" y1="22" x2="9" y2="22.01"></line><line x1="15" y1="22" x2="15" y2="22.01"></line><line x1="12" y1="22" x2="12" y2="22.01"></line><line x1="12" y1="2" x2="12" y2="22"></line><line x1="4" y1="10" x2="20" y2="10"></line><line x1="4" y1="14" x2="20" y2="14"></line><line x1="4" y1="18" x2="20" y2="18"></line></svg>
            <span class="text-sm md:text-base font-medium leading-snug">
                {{ employee.nome_unidade if employee.nome_unidade else (employee.unidade or 'Unidade não informada') }}
            </span>
        </div>
        
        <p class="text-sm text-slate-400 mt-1 flex items-center gap-2">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="20" height="16" x="2" y="4" rx="2"/><path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"/></svg>
            {{ employee.email }}
        </p>
    </div>

    <div class="flex flex-row md:flex-col items-center justify-center gap-3 mt-2 md:mt-0 md:pl-6 md:border-l md:border-slate-100 w-full md:w-auto">
        
        <button type="button" {% if employee.ramal %}onclick="copyRamal(this, '{{ employee.ramal }}')"{% else %}disabled{% endif %}
            class="group/ramal flex-1 md:flex-none w-full md:w-40 py-3 rounded-xl border transition-all duration-300 font-bold text-sm shadow-sm flex items-center justify-center gap-2 {{ 'bg-slate-50 text-slate-700 border-slate-200 hover:bg-emerald-500 hover:border-emerald-500 hover:text-white hover:shadow-emerald-200' if employee.ramal else 'bg-slate-50 text-slate-300 cursor-not-allowed' }}">
            
            <span class="default-content flex items-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/></svg>
                <span class="text-base">{{ employee.ramal or '--' }}</span>
            </span>
            <span class="success-content hidden flex items-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 6 9 17l-5-5"/></svg>
                Copiado!
            </span>
        </button>

        <button onclick="window.open('https://teams.microsoft.com/l/chat/0/0?users={{ employee.email }}', '_blank')" class="flex-1 md:flex-none w-full md:w-40 py-2.5 text-[#464775] bg-indigo-50 hover:bg-[#464775] hover:text-white rounded-xl transition-all border border-indigo-100 font-semibold text-sm flex items-center justify-center gap-2" title="Chat no Teams">
             <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg>
             Chat Teams
        </button>

    </div>
</div>
{% endmacro %}